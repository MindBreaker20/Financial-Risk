---
title: "Zajecia1"
author: "Bartlomiej Jamiolkowski"
date: "7 12 2021"
output:
  word_document: default
  html_document: default
  pdf_document: default
---

# 1 Exercise 1

```{r message=FALSE, warning=FALSE}
library(SciViews)
library(ggplot2)
library(dplyr)
library(hrbrthemes)
```

```{r}
kgh_d_2009 <- read.csv("kgh_d_2009.csv", header = TRUE)
kgh_d_2012 <- read.csv("kgh_d_2012.csv", header = TRUE)
kgh_d_2020 <- read.csv("kgh_d_2020.csv", header = TRUE)
kgh_m_2009 <- read.csv("kgh_m_2009.csv", header = TRUE)
kgh_w_2012 <- read.csv("kgh_w_2012.csv", header = TRUE)
kgh_w_2020 <- read.csv("kgh_w_2020.csv", header = TRUE)
```

## 1.1 KGHM quotation charts (closing prices)
### 1.1.1 Daily data from 2012 - 2013
```{r}
ggplot(data = kgh_d_2012, aes(x = as.Date(Data), y = Zamkniecie)) + 
  geom_line(color = "blue", size = 1) +
  ggtitle("Daily closing price for KGHM (2012 - 2013)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Time", y = "Adjusted close") 
```

```{r}
# Simple daily rate return 2012 - 2013
close_d_2012 <- kgh_d_2012$Zamkniecie
rate_of_return_d_2012_s <- rep(0, 483)
for(i in 1:483){
  rate_of_return_d_2012_s[i] = 100 * (close_d_2012[i + 1] - close_d_2012[i])/close_d_2012[i]
}
# Logarithmic daily rate return 2012 - 2013
close_d_2012 <- kgh_d_2012$Zamkniecie
rate_of_return_d_2012_l <- rep(0, 483)
for(i in 1:483){
  rate_of_return_d_2012_l[i] = 100 * log(close_d_2012[i + 1]/close_d_2012[i])
}
```


### 1.1.2 Weekly data for the years 2012 - 2013
```{r}
ggplot(data = kgh_w_2012, aes(x = as.Date(Data), y = Zamkniecie)) + 
  geom_line(color = "blue", size = 1) +
  ggtitle("Weekly closing price for KGHM (2012 - 2013)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Time", y = "Adjusted close") 
```

```{r}
# Simple daily rate return 2012 - 2013
close_w_2012 <- kgh_w_2012$Zamkniecie
rate_of_return_w_2012_s <- rep(0, 483)
for(i in 1:483){
  rate_of_return_w_2012_s[i] = 100 * (close_w_2012[i + 1] - close_w_2012[i])/close_w_2012[i]
}
# Logarithmic daily rate return 2012 - 2013
close_w_2012 <- kgh_w_2012$Zamkniecie
rate_of_return_w_2012_l <- rep(0, 483)
for(i in 1:483){
  rate_of_return_w_2012_l[i] = 100 * log(close_w_2012[i + 1]/close_w_2012[i])
}
```


### 1.1.3 Daily data from 2020 - 2021
```{r}
ggplot(data = kgh_d_2020, aes(x = as.Date(Data), y = Zamkniecie)) + 
  geom_line(color = "blue", size = 1) +
  ggtitle("Daily closing price for KGHM (2020 - 2021)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Time", y = "Adjusted close") 
```

```{r}
# Simple daily rate return 2020 - 2021
close_d_2020 <- kgh_d_2020$Zamkniecie
rate_of_return_d_2020_s <- rep(0, 483)
for(i in 1:483){
  rate_of_return_d_2020_s[i] = 100 * (close_d_2020[i + 1] - close_d_2020[i])/close_d_2020[i]
}

# Logarithmic daily rate return 2020 - 2021
close_d_2020 <- kgh_d_2020$Zamkniecie
rate_of_return_d_2020_l <- rep(0, 483)
for(i in 1:483){
  rate_of_return_d_2020_l[i] = 100 * log(close_d_2020[i + 1] / close_d_2020[i])
}
```


### 1.1.4 Weekly data for the years 2020 - 2021
```{r}
ggplot(data = kgh_w_2020, aes(x = as.Date(Data), y = Zamkniecie)) + 
  geom_line(color = "blue", size = 1) +
  ggtitle("Weekly closing price for KGHM (2020 - 2021)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Time", y = "Adjusted close") 
```

```{r}
# Simple weekly rate return 2020 - 2021
close_w_2020 <- kgh_w_2020$Zamkniecie
rate_of_return_w_2020_s <- rep(0, 100)
for(i in 1:100){
  rate_of_return_w_2020_s[i] = 100 * (close_w_2020[i + 1] - close_w_2020[i])/close_w_2020[i]
}

# Logarithmic weekly rate return 2020 - 2021
close_w_2020 <- kgh_w_2020$Zamkniecie
rate_of_return_w_2020_l <- rep(0, 100)
for(i in 1:100){
  rate_of_return_w_2020_l[i] = 100 * log(close_w_2020[i + 1] / close_w_2020[i])
}
```


### 1.1.5 Monthly data from 2009 to 2021
```{r}
ggplot(data = kgh_m_2009, aes(x = as.Date(Data), y = Zamkniecie)) + 
  geom_line(color = "blue", size = 1) +
  ggtitle("Monthly closing price for KGHM (2009 - 2021)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "Time", y = "Adjusted close") 
```

```{r}
# Simple monthly rate return 2009 - 2021
close_m_2009 <- kgh_m_2009$Zamkniecie
rate_of_return_m_2009_s <- rep(0, 155)
for(i in 1:155){
  rate_of_return_m_2009_s[i] = 100 * (close_m_2009[i + 1] - close_m_2009[i])/close_m_2009[i]
}
# Logarithmic monthly rate return 2009 - 2021
close_m_2009 <- kgh_m_2009$Zamkniecie
rate_of_return_m_2009_l <- rep(0, 155)
for(i in 1:155){
  rate_of_return_m_2009_l[i] = 100 * log(close_m_2009[i + 1] / close_m_2009[i])
}
```


## 1.2 Graphs of both types of rates of return and a graph of the difference between the simple and log rate
### 1.2.1 Daily simple rate of return from 2020 to 2021
```{r}
data1 <- data.frame(
  day = as.Date(kgh_d_2020$Data[-1]),
  value = rate_of_return_d_2020_s
)

ggplot(data = data1, aes(x = day, y = value)) + 
  geom_line(color = "blue", size = 1) +
  geom_point(color="red") +
  ggtitle("Daily returns on KGHM (2020 - 2021)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "time", y = "return") 
```

### 1.2.2 Daily logarithmic rate of return from 2020 to 2021
```{r}
data2 <- data.frame(
  day = as.Date(kgh_d_2020$Data[-1]),
  value = rate_of_return_d_2020_l
)

ggplot(data = data2, aes(x = day, y = value)) + 
  geom_line(color = "blue", size = 1) +
  geom_point(color="red") +
  ggtitle("Daily returns on KGHM (2020 - 2021)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "time", y = "return") 
```

### 1.2.3 The difference between the daily simple rate and the daily logarithmic rate for the years 2020-2021
```{r}
data3 <- data.frame(
  day = as.Date(kgh_d_2020$Data[-1]),
  value = rate_of_return_d_2020_s - rate_of_return_d_2020_l
)

ggplot(data = data3, aes(x = day, y = value)) + 
  geom_line(color = "blue", size = 1) +
  geom_point(color="red") +
  ggtitle("The difference between a simple and logarithmic daily rate on KGHM (2020 - 2021)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "time", y = "return") 
```

### 1.2.4 Weekly simple rate of return from 2020 to 2021
```{r}
data4 <- data.frame(
  day = as.Date(kgh_w_2020$Data[-1]),
  value = rate_of_return_w_2020_s
)

ggplot(data = data4, aes(x = day, y = value)) + 
  geom_line(color = "blue", size = 1) +
  geom_point(color="red") +
  ggtitle("Weekly returns on KGHM (2020 - 2021)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "time", y = "return") 
```


### 1.2.5 Weekly logarithmic rate of return from 2020 to 2021

```{r}
data5 <- data.frame(
  day = as.Date(kgh_w_2020$Data[-1]),
  value = rate_of_return_w_2020_l
)

ggplot(data = data5, aes(x = day, y = value)) + 
  geom_line(color = "blue", size = 1) +
  geom_point(color="red") +
  ggtitle("Weekly returns on KGHM (2020 - 2021)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "time", y = "return") 
```

### 1.2.6 The difference between the weekly simple and logarithmic rate for the years 2020-2021
```{r}
data6 <- data.frame(
  day = as.Date(kgh_w_2020$Data[-1]),
  value = rate_of_return_w_2020_s - rate_of_return_w_2020_l
)

ggplot(data = data6, aes(x = day, y = value)) + 
  geom_line(color = "blue", size = 1) +
  geom_point(color="red") +
  ggtitle("The difference between a simple and logarithmic weekly rate on KGHM (2020 - 2021)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "time", y = "return") 
```

### 1.2.7 Monthly simple rate of return from 2009 to 2021

```{r}
data7 <- data.frame(
  day = as.Date(kgh_m_2009$Data[-1]),
  value = rate_of_return_m_2009_s
)

ggplot(data = data7, aes(x = day, y = value)) + 
  geom_line(color = "blue", size = 1) +
  geom_point(color="red") +
  ggtitle("Monthly returns on KGHM (2009 - 2021)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "time", y = "return") 
```

### 1.2.8 Monthly logarithmic rate of return from 2009 to 2021

```{r}
data8 <- data.frame(
  day = as.Date(kgh_m_2009$Data[-1]),
  value = rate_of_return_m_2009_l
)

ggplot(data = data8, aes(x = day, y = value)) + 
  geom_line(color = "blue", size = 1) +
  geom_point(color="red") +
  ggtitle("Monthly returns on KGHM (2009 - 2021)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "time", y = "return")
```

### 1.2.9 Difference between the monthly simple and logarithmic rate for 2009-2021

```{r}
data9 <- data.frame(
  day = as.Date(kgh_m_2009$Data[-1]),
  value = rate_of_return_m_2009_s - rate_of_return_m_2009_l
)

ggplot(data = data9, aes(x = day, y = value)) + 
  geom_line(color = "blue", size = 1) +
  geom_point(color="red") +
  ggtitle("The difference between a simple and logarithmic monthly rate on KGHM (2009 - 2021)") +
  theme(plot.title = element_text(hjust = 0.5)) +
  labs(x = "time", y = "return")

```
**Interpretation**

The presented graphs of the differences of the two types of returns indicate that logarithmic rates of return are always smaller than simple rates of return. As are the rates of return, t the differences are greater.

# 2. Exercise 2
## 2.1 Shapiro-Wilk test
```{r}
# Daily logarithmic rates of return
shapiro.test(rate_of_return_d_2012_l)

shapiro.test(rate_of_return_d_2020_l)

# Weekly logarithmic rates of return
shapiro.test(rate_of_return_w_2012_l)

shapiro.test(rate_of_return_w_2020_l)

# Monthly logarithmic rates of return
shapiro.test(rate_of_return_m_2009_l)

```
**Interpretation**

The study of the normality of the distribution of logarithmic rates of return is carried out in the Shapiro-Wilk test at the significance level of 0.05. The null hypothesis is the normality of the tested variable distribution.
The p-value in the first test is 8.006e-05, which is less than alpha, which means rejecting the null hypothesis. The distribution of the daily rate of return from 2012-2013 is not normal.
The p-value in the second test is 6.695e-09, less than alpha, which means rejecting the null hypothesis. The distribution of the daily rate of return for 2020-2021 is not normal.
The p-value in the first test is 2.272e-06, less than alpha, which means rejecting the null hypothesis. The distribution of the weekly rate of return from 2012-2013 is not normal.
The p-value in the first test is 0.0001342 and is less than alpha, which means rejecting the null hypothesis. The distribution of the weekly rate of return for 2020-2021 is not normal.
The p-value in the first test is 0.3585 and is greater than alpha, which means not rejecting the null hypothesis. The monthly rate of return for 2009-2021 has a normal distribution.

## 2.2 Anderson-Darling test
```{r}
library(nortest)

# Daily logarithmic rates of return
ad.test(rate_of_return_d_2012_l)

ad.test(rate_of_return_d_2020_l)

# Weekly logarithmic rates of return
ad.test(rate_of_return_w_2012_l)

ad.test(rate_of_return_w_2020_l)

# Monthly logarithmic rates of return
ad.test(rate_of_return_m_2009_l)
```
**Interpretation**

The study of the normality of the distribution of logarithmic rates of return is carried out in the Anderson-Darling test with a significance level of 0.05. The null hypothesis is the normality of the tested variable distribution.
The p-value in the first test is 0.004606 and is less than alpha, which means rejecting the null hypothesis. The distribution of the daily rate of return from 2012-2013 is not normal.
The p-value in the second test is 2971e-07, less than alpha, which means rejecting the null hypothesis. The distribution of the daily rate of return for 2020-2021 is not normal.
The p-value in the first test is 0.007075 and is less than alpha, which means rejecting the null hypothesis. The distribution of the weekly rate of return from 2012-2013 is not normal.
The p-value in the first test is 0.01286, which is less than alpha, which means rejecting the null hypothesis. The distribution of the weekly rate of return for 2020-2021 is not normal.
The p-value in the first test is 0.1414 and is greater than alpha, which means not rejecting the null hypothesis. The monthly rate of return distribution for 2009-2021 is normal.

## 2.3 Jarque-Bera test
```{r}
library(tseries)
library(DescTools)
# Daily logarithmic rates of return
jarque.bera.test(rate_of_return_d_2012_l)

jarque.bera.test(rate_of_return_d_2020_l)

# Weekly logarithmic rates of return
JarqueBeraTest(rate_of_return_w_2020_l, robust = TRUE, method = c("chisq", "mc"), N = 0, na.rm = FALSE)

jarque.bera.test(rate_of_return_w_2020_l)

# Monthly logarithmic rates of return
jarque.bera.test(rate_of_return_m_2009_l)
```
**Interpretation**

The study of the normality of the distribution of logarithmic rates of return is carried out in the Jarque-Ber test at the significance level of 0.05. The null hypothesis is the normality of the tested variable distribution.
The p-value in the first test is 1.777e-11i is less than alpha, which means rejecting the null hypothesis. The distribution of the daily rate of return from 2012-2013 is not normal.
The p-value in the second test is 2.2e-16, less than alpha, which means rejecting the null hypothesis. The distribution of the daily rate of return for 2020-2021 is not normal.
The p-value in the first test is 2.2e-16, less than alpha, which means rejecting the null hypothesis. The distribution of the weekly rate of return from 2012-2013 is not normal.
The p-value in the first test is 4.718e-14, less than alpha, which means rejecting the null hypothesis. The distribution of the weekly rate of return for 2020-2021 is not normal.
The p-value in the first test is 0.6505 and is greater than alpha, which means not rejecting the null hypothesis. The monthly rate of return distribution for 2009-2021 is normal.

**The presented results show that the daily and weekly logatrhythmic rates of return do not have a normal distribution. Monthly rates of return can be normally staggered due to the central limit theorem**

# 3. Exercise 3

```{r}
data0 <- as.data.frame(kgh_d_2009) 
close_d_2009 <- rev(data0$Ostatnio)
close_d_2009 <- as.double(factor(close_d_2009))
rate_of_return_d_2009_l <- rep(0, 3040)
for(i in 1:3040){
  rate_of_return_d_2009_l[i] = 100 * log(close_d_2009[i + 1]/close_d_2009[i])
}

m = mean(rate_of_return_d_2009_l)
s = sd(rate_of_return_d_2009_l)

rate_of_return_d_2009_1sd_left <- c()
for(i in 1:3040){
  if(rate_of_return_d_2009_l[i] < m && rate_of_return_d_2009_l[i] > (m - s)){
    rate_of_return_d_2009_1sd_left <- append(rate_of_return_d_2009_1sd_left, rate_of_return_d_2009_l[i])
  }
}

rate_of_return_d_2009_1sd_right <- c()
for(i in 1:3040){
  if(rate_of_return_d_2009_l[i] > m && rate_of_return_d_2009_l[i] < (m + s)){
    rate_of_return_d_2009_1sd_right <- append(rate_of_return_d_2009_1sd_right, rate_of_return_d_2009_l[i])
  }
}

par(mfrow = c(1, 2))    
hist(rate_of_return_d_2009_1sd_left, freq = FALSE, main = "Daily returns on KGHM < 1 SD")
lines(density(rate_of_return_d_2009_l), lwd = 2, col = 'red')
hist(rate_of_return_d_2009_1sd_right, freq = FALSE, main = "Daily returns on KGHM > 1 SD")
lines(density(rate_of_return_d_2009_l), lwd = 2, col = 'red')
```

```{r}
rate_of_return_d_2009_1_2sd_left <- c()
for(i in 1:3040){
  if(rate_of_return_d_2009_l[i] < (m - s) && rate_of_return_d_2009_l[i] > (m - 2*s)){
    rate_of_return_d_2009_1_2sd_left <- append(rate_of_return_d_2009_1_2sd_left, rate_of_return_d_2009_l[i])
  }
}

rate_of_return_d_2009_1_2sd_right <- c()
for(i in 1:3040){
  if(rate_of_return_d_2009_l[i] > (m + s) && rate_of_return_d_2009_l[i] < (m + 2*s)){
    rate_of_return_d_2009_1_2sd_right <- append(rate_of_return_d_2009_1_2sd_right, rate_of_return_d_2009_l[i])
  }
}

par(mfrow = c(1, 2))  
hist(rate_of_return_d_2009_1_2sd_left, freq = FALSE, main = "Daily returns on KGHM 2-1 SD")
lines(density(rate_of_return_d_2009_l), lwd = 2, col = 'red')
hist(rate_of_return_d_2009_1_2sd_right, freq = FALSE, main = "Daily returns on KGHM 1-2 SD")
lines(density(rate_of_return_d_2009_l), lwd = 2, col = 'red')
```

```{r}
rate_of_return_d_2009_2_3sd_left <- c()
for(i in 1:3040){
  if(rate_of_return_d_2009_l[i] < (m - 2*s) && rate_of_return_d_2009_l[i] > (m - 3*s)){
    rate_of_return_d_2009_2_3sd_left <- append(rate_of_return_d_2009_2_3sd_left, rate_of_return_d_2009_l[i])
  }
}

rate_of_return_d_2009_2_3sd_right <- c()
for(i in 1:3040){
  if(rate_of_return_d_2009_l[i] > (m + 2*s) && rate_of_return_d_2009_l[i] < (m + 3*s)){
    rate_of_return_d_2009_2_3sd_right <- append(rate_of_return_d_2009_2_3sd_right, rate_of_return_d_2009_l[i])
  }
}

par(mfrow = c(1, 2))  
hist(rate_of_return_d_2009_2_3sd_left, freq = FALSE, main = "Daily returns on KGHM 3-2 SD")
lines(density(rate_of_return_d_2009_l), lwd = 2, col = 'red')
hist(rate_of_return_d_2009_2_3sd_right, freq = FALSE, main = "Daily returns on KGHM 2-3 SD")
lines(density(rate_of_return_d_2009_l), lwd = 2, col = 'red')
```

In the case of 3-4 SDs, visualization is not possible due to the fact that only one point meets this cruterium.

```{r}
rate_of_return_d_2009_4_5sd_left <- c()
for(i in 1:3040){
  if(rate_of_return_d_2009_l[i] < (m - 4*s) && rate_of_return_d_2009_l[i] > (m - 5*s)){
    rate_of_return_d_2009_4_5sd_left <- append(rate_of_return_d_2009_4_5sd_left, rate_of_return_d_2009_l[i])
  }
}

rate_of_return_d_2009_4_5sd_right <- c()
for(i in 1:3040){
  if(rate_of_return_d_2009_l[i] > (m + 4*s) && rate_of_return_d_2009_l[i] < (m + 5*s)){
    rate_of_return_d_2009_4_5sd_right <- append(rate_of_return_d_2009_4_5sd_right, rate_of_return_d_2009_l[i])
  }
}

par(mfrow = c(1, 2))  
hist(rate_of_return_d_2009_4_5sd_left, freq = FALSE, main = "Daily returns on KGHM 5-4 SD")
lines(density(rate_of_return_d_2009_l), lwd = 2, col = 'red')
hist(rate_of_return_d_2009_4_5sd_right, freq = FALSE, main = "Daily returns on KGHM 4-5 SD")
lines(density(rate_of_return_d_2009_l), lwd = 2, col = 'red')
```

```{r}
rate_of_return_d_2009_5sd_left <- c()
for(i in 1:3040){
  if(rate_of_return_d_2009_l[i] < (m - 5*s)){
    rate_of_return_d_2009_5sd_left <- append(rate_of_return_d_2009_5sd_left, rate_of_return_d_2009_l[i])
  }
}

rate_of_return_d_2009_5sd_right <- c()
for(i in 1:3040){
  if(rate_of_return_d_2009_l[i] > (m + 5*s)){
    rate_of_return_d_2009_5sd_right <- append(rate_of_return_d_2009_5sd_right, rate_of_return_d_2009_l[i])
  }
}

par(mfrow = c(1, 2))  
hist(rate_of_return_d_2009_5sd_left, freq = FALSE, main = "Daily returns on KGHM < 5 SD")
lines(density(rate_of_return_d_2009_l), lwd = 2, col = 'red')
hist(rate_of_return_d_2009_5sd_right, freq = FALSE, main = "Daily returns on KGHM > 5 SD")
lines(density(rate_of_return_d_2009_l), lwd = 2, col = 'red')
```

**Interpretation**

The presented charts show that in the case of the value of the rates of return, one cannot speak of symmetrical increases and decreases in prices.
Only in the case of values lower than 1 SD can one suspect symmetrical conclusions and decreases. Big ups and downs are common, so there is no this symmetry.

# 4. Exercise 4

```{r}
library(stabledist)
plot(density(rate_of_return_d_2009_l),col='blue',lwd=3,main='Distribution of (2009-2021) daily returns on KGHM', xlim = c(-100, 100), ylim = c(0, 0.12), xlab = "return")
curve(dt(x, df = 3),add=TRUE,col='purple',lwd=3)
curve(dlogis(x),add=TRUE,col='red',lwd=3)
curve(dstable(x, alpha=1.2, beta = .8, gamma = 3, delta = 2), -100, 100, col="green", lwd=3,add=TRUE)
legend("topright",bg='white',bty="n",cex=1,lty=1,lwd=c(4,3),
       c('empirical','t-Student','logistic distribution','alpha-stable'),col=c('blue','purple','red','green'))
```

**Interpretation**

When analyzing the graph, it can be noticed that the alpha-stable distribution would fit best to the rate of return distribution.

